<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chat Viewer</title>
  <style>
    html,body { height:100%; margin:0; background:#0b0b0b; color:#ddd; font-family:system-ui; }
    #chat-container { position:absolute; top:10px; left:10px; max-width:420px; height:calc(100% - 20px); display:flex; flex-direction:column; background:rgba(20,20,20,0.6); border:2px solid #4caf50; border-radius:12px; padding:8px; box-sizing:border-box; overflow:hidden; }
    #messages { flex:1; overflow-y:auto; padding:8px; }
    .msg { margin:4px 0; padding:6px 8px; border-radius:6px; background:rgba(255,255,255,0.03); }
    .meta { font-size:11px; color:#aaa; margin-bottom:4px; }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="messages"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const messagesEl = document.getElementById('messages');

    function addMessage(m) {
      const d = new Date(m.ts || Date.now());
      const el = document.createElement('div');
      el.className = 'msg';
      el.innerHTML = '<div class="meta">'+(m.user||'anon')+' â€¢ '+d.toLocaleTimeString()+'</div><div>'+escapeHtml(m.text)+'</div>';
      messagesEl.appendChild(el);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function escapeHtml(s){return (''+s).replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));}

    socket.on('history', hist => { messagesEl.innerHTML=''; hist.forEach(addMessage); });
    socket.on('message', addMessage);
  </script>
</body>
</html>
